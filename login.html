<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>Sign in — PINE Tycoon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      .card {
        position: relative;
        background: #ffffff;
        padding: 20px 24px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        max-width: 380px;
        width: 100%;
      }

      .lang-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        border: 1px solid #ccc;
        background: #fff;
        border-radius: 999px;
        padding: 6px 10px;
        cursor: pointer;
        font-size: 12px;
      }

      h1 {
        margin-top: 0;
        text-align: center;
      }

      label {
        display: block;
        margin-top: 10px;
        font-size: 14px;
      }

      input {
        width: 100%;
        padding: 8px 10px;
        margin-top: 4px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      button[type="submit"] {
        width: 100%;
        margin-top: 14px;
        padding: 10px;
        border-radius: 6px;
        border: none;
        background: #383837;
        color: #fff;
        font-size: 15px;
        cursor: pointer;
      }

      button:hover { opacity: 0.9; }

      .msg {
        margin-top: 10px;
        font-size: 13px;
        min-height: 18px;
      }

      .msg.error { color: #c00; }
      .msg.success { color: #008800; }

      .back-link {
        margin-top: 10px;
        font-size: 13px;
        text-align: center;
      }

      .back-link a {
        color: #333;
        text-decoration: none;
      }

      .back-link a:hover { text-decoration: underline; }
    </style>
  </head>

  <body>
    <div class="card">
      <button class="lang-btn" id="langBtn" type="button">EN</button>

      <h1 id="titleH1">Вхід</h1>

      <form id="loginForm">
        <label id="labelName">
          Нікнейм
          <input type="text" id="loginName" required placeholder="Наприклад: davyd3102" />
        </label>

        <label id="labelPass">
          Пароль
          <input type="password" id="loginPassword" required />
        </label>

        <button type="submit" id="submitBtn">Увійти</button>
      </form>

      <div id="loginMsg" class="msg"></div>

      <div class="back-link">
        <span id="noAccText">Немає акаунта?</span> <a href="signup.html" id="signupLink">Sign up</a><br />
        <a href="index.html" id="backHomeLink">← Повернутися на головну</a>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDZEwAbFwLQXxlkkmuMKBFof2J3OE02Egs",
        authDomain: "pine-tycoon.firebaseapp.com",
        projectId: "pine-tycoon",
        storageBucket: "pine-tycoon.firebasestorage.app",
        messagingSenderId: "949986190236",
        appId: "1:949986190236:web:4f5d50078326f5c1981e59",
        measurementId: "G-2DY6KSY4G7"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const form = document.getElementById("loginForm");
      const nameInput = document.getElementById("loginName");
      const passInput = document.getElementById("loginPassword");
      const msgEl = document.getElementById("loginMsg");

      const T = {
        uk: {
          h1: "Вхід",
          name: "Нікнейм",
          pass: "Пароль",
          submit: "Увійти",
          noAcc: "Немає акаунта?",
          backHome: "← Повернутися на головну",
          phName: "Наприклад: davyd3102",

          errName: "Введи нік.",
          ok: "Успішний вхід! Переходимо на головну...",
          nf: "Акаунт з таким ніком не знайдено.",
          wp: "Неправильний пароль.",
          fail: (m) => "Помилка входу: " + m,
        },
        en: {
          h1: "Sign in",
          name: "Username",
          pass: "Password",
          submit: "Sign in",
          noAcc: "No account?",
          backHome: "← Back to home",
          phName: "Example: davyd3102",

          errName: "Please type a username.",
          ok: "Signed in! Redirecting to home...",
          nf: "No account found with that username.",
          wp: "Wrong password.",
          fail: (m) => "Sign in error: " + m,
        }
      };

      function getLang() {
        return localStorage.getItem("pineLang") || "uk";
      }

      function setLang(lang) {
        localStorage.setItem("pineLang", lang);
        document.documentElement.lang = lang;

        const t = T[lang];
        document.getElementById("titleH1").textContent = t.h1;

        document.getElementById("labelName").childNodes[0].textContent = t.name + " ";
        document.getElementById("labelPass").childNodes[0].textContent = t.pass + " ";
        document.getElementById("submitBtn").textContent = t.submit;

        document.getElementById("noAccText").textContent = t.noAcc;
        document.getElementById("backHomeLink").textContent = t.backHome;

        nameInput.placeholder = t.phName;

        document.getElementById("langBtn").textContent = (lang === "uk") ? "EN" : "UK";
      }

      document.getElementById("langBtn").addEventListener("click", () => {
        const cur = getLang();
        setLang(cur === "uk" ? "en" : "uk");
      });

      setLang(getLang());

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        msgEl.textContent = "";
        msgEl.className = "msg";

        const lang = getLang();
        const t = T[lang];

        const name = nameInput.value.trim();
        const pass = passInput.value;

        if (!name) {
          msgEl.textContent = t.errName;
          msgEl.classList.add("error");
          return;
        }

        const email = name.toLowerCase() + "@pine.local";

        try {
          await signInWithEmailAndPassword(auth, email, pass);
          msgEl.textContent = t.ok;
          msgEl.classList.add("success");

          setTimeout(() => (window.location.href = "index.html"), 700);
        } catch (err) {
          console.error(err);
          msgEl.classList.add("error");

          if (err.code === "auth/user-not-found") msgEl.textContent = t.nf;
          else if (err.code === "auth/wrong-password") msgEl.textContent = t.wp;
          else msgEl.textContent = t.fail(err.message);
        }
      });
    </script>
  </body>
</html>
